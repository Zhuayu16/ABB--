# 模型选择与方向调整功能说明

## 功能概述

已成功为路径切片与仿真系统添加了完整的模型选择和方向调整功能。用户现在可以通过直观的界面选择模型文件，并实时调整模型的旋转、缩放和位置。

## 主要功能

### 1. 模型选择功能
- **文件支持**：支持STL和STEP格式的模型文件
- **选择按钮**：左侧控制面板的"选择模型"按钮
- **模型信息显示**：实时显示模型的顶点数、面数、尺寸等信息
- **自动加载**：选择文件后自动加载到3D视图并更新控制面板

### 2. 旋转控制功能
- **三轴旋转**：X轴、Y轴、Z轴独立旋转控制
- **双重控制**：滑块和数值输入框双重控制方式
- **角度范围**：-180°到+180°的旋转角度
- **实时预览**：旋转调整时实时更新3D视图

### 3. 缩放控制功能
- **缩放范围**：0.1倍到5.0倍的缩放比例
- **精确控制**：滑块和数值输入框精确控制
- **实时预览**：缩放调整时实时更新3D视图

### 4. 位置控制功能
- **三轴位置**：X、Y、Z轴独立位置控制
- **移动范围**：-100mm到+100mm的移动范围
- **精确控制**：数值输入框精确控制位置
- **实时预览**：位置调整时实时更新3D视图

### 5. 快速操作功能
- **重置变换**：一键重置所有变换参数
- **居中模型**：自动将模型居中到坐标系原点
- **适应视图**：自动调整视图以适应模型

## 界面布局

### 左侧控制面板
```
┌─────────────────────────────────┐
│ 模型选择                         │
│ [选择模型]                       │
│ 模型信息显示区域                 │
├─────────────────────────────────┤
│ 模型变换                         │
│ 旋转控制:                        │
│ X轴: [滑块] [数值]               │
│ Y轴: [滑块] [数值]               │
│ Z轴: [滑块] [数值]               │
│ 缩放控制:                        │
│ 缩放: [滑块] [数值]              │
│ 位置控制:                        │
│ X: [数值] Y: [数值] Z: [数值]    │
├─────────────────────────────────┤
│ 快速操作                         │
│ [重置变换] [居中模型] [适应视图] │
└─────────────────────────────────┘
```

### 右侧3D视图
- 实时显示模型和变换效果
- 支持鼠标交互（旋转、缩放、平移视图）
- 显示坐标轴和网格

## 技术实现

### 1. 界面组件
- **QGroupBox**：分组显示不同功能区域
- **QSlider**：滑块控制，提供直观的数值调整
- **QSpinBox/QDoubleSpinBox**：数值输入框，提供精确控制
- **QPushButton**：功能按钮
- **QLabel**：信息显示

### 2. 信号连接
- 滑块和数值输入框双向绑定
- 参数变化时自动触发模型变换
- 实时更新3D视图显示

### 3. 模型变换算法
```python
# 1. 缩放变换
vertices = vertices * scale_factor

# 2. 旋转变换
Rx = [[1,0,0],[0,cos(rx),-sin(rx)],[0,sin(rx),cos(rx)]]
Ry = [[cos(ry),0,sin(ry)],[0,1,0],[-sin(ry),0,cos(ry)]]
Rz = [[cos(rz),-sin(rz),0],[sin(rz),cos(rz),0],[0,0,1]]
R = Rz @ Ry @ Rx
vertices = vertices @ R.T

# 3. 平移变换
vertices = vertices + position_offset
```

### 4. 兼容性处理
- **STL文件**：直接使用trimesh加载
- **STEP文件**：使用pythonocc-core生成三角网格
- **版本兼容**：处理不同版本API的差异
- **错误处理**：提供回退机制和错误提示

## 使用方法

### 1. 选择模型
1. 点击左侧控制面板的"选择模型"按钮
2. 在文件对话框中选择STL或STEP文件
3. 模型将自动加载并显示在3D视图中

### 2. 调整旋转
1. 使用X轴、Y轴、Z轴的滑块或数值输入框
2. 调整角度范围：-180°到+180°
3. 实时查看3D视图中的旋转效果

### 3. 调整缩放
1. 使用缩放滑块或数值输入框
2. 调整缩放范围：0.1倍到5.0倍
3. 实时查看3D视图中的缩放效果

### 4. 调整位置
1. 使用X、Y、Z位置的数值输入框
2. 调整位置范围：-100mm到+100mm
3. 实时查看3D视图中的位置效果

### 5. 快速操作
- **重置变换**：点击按钮重置所有变换参数
- **居中模型**：点击按钮将模型居中到原点
- **适应视图**：点击按钮调整视图以适应模型

## 样式设计

### 1. 颜色方案
- **背景色**：#2b2b2b（深灰色）
- **主色调**：#FF9900（橙色）
- **文字色**：#ffffff（白色）
- **边框色**：#555555（中灰色）

### 2. 交互效果
- **悬停效果**：按钮悬停时颜色变亮
- **按下效果**：按钮按下时颜色变暗
- **禁用状态**：按钮禁用时显示灰色

### 3. 布局设计
- **固定宽度**：控制面板宽度300像素
- **合理间距**：组件间10像素间距
- **分组显示**：功能按逻辑分组显示

## 性能优化

### 1. 实时更新优化
- 使用信号槽机制避免频繁更新
- 参数变化时延迟更新，避免卡顿
- 3D视图更新时使用高效的重绘机制

### 2. 内存管理
- 及时清理旧的模型数据
- 重用变换后的顶点数据
- 避免不必要的数组复制

### 3. 错误处理
- 完善的异常捕获和处理
- 用户友好的错误提示
- 自动回退到安全状态

## 扩展功能

### 1. 预设变换
- 可以添加常用的变换预设
- 如"水平放置"、"垂直放置"等
- 一键应用预设变换

### 2. 变换历史
- 记录变换操作历史
- 支持撤销和重做功能
- 保存变换参数到项目文件

### 3. 批量处理
- 支持同时加载多个模型
- 批量应用相同的变换
- 模型间的相对位置控制

## 总结

模型选择与方向调整功能为用户提供了直观、高效的模型操作界面。通过滑块和数值输入框的双重控制方式，用户可以精确地调整模型的位置、旋转和缩放。实时预览功能让用户能够立即看到变换效果，大大提高了工作效率。

该功能完全集成到现有的路径切片与仿真系统中，与切片、优化、仿真等功能无缝配合，为用户提供了完整的模型处理解决方案。 