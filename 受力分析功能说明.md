# 受力分析功能说明

## 功能概述

已成功为路径切片与仿真系统添加了完整的受力分析功能，用不同颜色显示模型的结构和受力情况。该功能基于有限元分析原理，提供专业的应力分析和安全评估。

## 主要功能特性

### 1. 专业受力分析
- **有限元分析**：基于简化的有限元方法进行应力计算
- **多种材料支持**：钢材、铝合金、钛合金、不锈钢、铸铁等
- **多种载荷类型**：重力、压力、集中力、弯矩、扭矩、组合载荷
- **多种约束条件**：固定底面、固定侧面、固定顶面、简支、自定义

### 2. 可视化应力分布
- **颜色映射**：使用jet颜色映射显示应力分布
  - 蓝色：低应力区域
  - 绿色：中等应力区域  
  - 红色：高应力区域
- **应力云图**：实时显示von Mises应力分布
- **颜色条**：显示应力值范围和单位
- **边缘显示**：显示模型边缘轮廓

### 3. 安全评估
- **安全系数计算**：自动计算结构安全系数
- **安全状态判断**：根据安全系数判断结构是否安全
- **优化建议**：提供结构优化建议

### 4. 分析报告
- **详细报告**：生成包含所有分析参数的详细报告
- **数据统计**：应力、位移的统计信息
- **安全评估**：安全系数和安全状态
- **优化建议**：针对不安全结构的改进建议
- **报告导出**：支持导出为文本文件

## 技术实现

### 1. 应力分析算法

#### 有限元分析流程
```python
# 1. 网格准备
vertices = mesh.vertices  # 节点坐标
faces = mesh.faces        # 单元连接关系

# 2. 材料属性设置
E = elastic_modulus * 1e9  # 弹性模量 (Pa)
nu = poisson_ratio         # 泊松比

# 3. 边界条件处理
fixed_nodes = get_fixed_nodes(constraint_type, vertices)

# 4. 载荷施加
node_forces = calculate_node_forces(load_type, magnitude, vertices, faces)

# 5. 应力计算
stress_field = calculate_simplified_stress(vertices, faces, E, nu, node_forces, fixed_nodes)

# 6. 位移计算
displacement_field = calculate_displacement(vertices, stress_field, E, nu)

# 7. Von Mises应力计算
von_mises = calculate_von_mises_stress(stress_field)
```

#### Von Mises应力公式
```
σ_vm = √(0.5 * ((σ_xx - σ_yy)² + (σ_yy - σ_zz)² + (σ_zz - σ_xx)² + 6(τ_xy² + τ_yz² + τ_xz²)))
```

### 2. 颜色映射算法

#### 应力归一化
```python
# 归一化应力值到0-1范围
stress_min = np.min(von_mises)
stress_max = np.max(von_mises)
normalized_stress = (von_mises - stress_min) / (stress_max - stress_min)
```

#### 颜色映射
```python
# 从蓝色到红色的颜色映射
for i, stress in enumerate(normalized_stress):
    if stress < 0.5:
        # 蓝色到绿色
        colors[i] = [0, stress * 2, 1 - stress * 2]
    else:
        # 绿色到红色
        colors[i] = [(stress - 0.5) * 2, 1 - (stress - 0.5) * 2, 0]
```

### 3. 安全系数计算
```python
# 安全系数计算
yield_strength = 250e6  # 材料屈服强度 (Pa)
max_stress = np.max(von_mises)
safety_factor = yield_strength / max_stress
```

## 使用方法

### 1. 启动受力分析
1. 加载3D模型（STL或STEP格式）
2. 点击"预览"标签页
3. 点击"受力分析"按钮

### 2. 设置分析参数
在受力分析参数设置对话框中配置：

#### 材料属性
- **材料类型**：选择预定义材料或自定义
- **弹性模量**：材料的弹性模量（GPa）
- **泊松比**：材料的泊松比
- **密度**：材料密度（kg/m³）

#### 边界条件
- **约束类型**：选择约束方式
- **载荷类型**：选择载荷类型
- **载荷大小**：设置载荷大小（N）

#### 分析设置
- **网格密度**：选择网格密度
- **分析类型**：选择分析类型
- **安全系数**：设置目标安全系数

### 3. 查看分析结果
- **3D应力云图**：在3D视图中查看应力分布
- **颜色条**：查看应力值范围
- **分析报告**：查看详细的分析报告

### 4. 导出结果
- 点击"导出报告"按钮
- 选择保存位置
- 生成文本格式的分析报告

## 材料库

### 预定义材料属性

| 材料类型 | 弹性模量 (GPa) | 泊松比 | 密度 (kg/m³) |
|---------|---------------|--------|-------------|
| 钢材    | 210           | 0.30   | 7850        |
| 铝合金  | 70            | 0.33   | 2700        |
| 钛合金  | 116           | 0.32   | 4500        |
| 不锈钢  | 200           | 0.29   | 8000        |
| 铸铁    | 100           | 0.25   | 7200        |

### 自定义材料
用户可以输入自定义的材料属性，系统会自动保存并应用。

## 载荷类型说明

### 1. 重力载荷
- 作用方向：Z轴负方向
- 计算公式：F = m * g
- 适用场景：结构自重分析

### 2. 压力载荷
- 作用方式：均匀分布压力
- 计算方式：根据面面积分配
- 适用场景：流体压力、接触压力

### 3. 集中力
- 作用位置：模型最高点
- 作用方向：Z轴负方向
- 适用场景：点载荷分析

### 4. 其他载荷
- **弯矩**：弯曲力矩分析
- **扭矩**：扭转分析
- **组合载荷**：多种载荷组合

## 约束类型说明

### 1. 固定底面
- 约束节点：Z坐标最小的节点
- 适用场景：底座固定结构

### 2. 固定侧面
- 约束节点：X坐标最小和最大的节点
- 适用场景：侧壁固定结构

### 3. 固定顶面
- 约束节点：Z坐标最大的节点
- 适用场景：顶部固定结构

### 4. 简支
- 约束方式：简支边界条件
- 适用场景：简支梁分析

## 安全评估标准

### 安全系数计算
```
安全系数 = 材料屈服强度 / 最大Von Mises应力
```

### 安全状态判断
- **安全**：安全系数 ≥ 目标安全系数
- **不安全**：安全系数 < 目标安全系数

### 优化建议
当结构不安全时，系统会提供以下建议：
- 增加材料厚度
- 使用更高强度材料
- 优化结构设计
- 减少载荷大小

## 性能优化

### 1. 计算优化
- 使用简化的有限元算法
- 向量化计算提高效率
- 内存优化避免大模型卡顿

### 2. 显示优化
- 使用PyVista高效渲染
- 颜色映射优化
- 实时更新应力分布

### 3. 用户体验
- 异步计算避免界面卡死
- 进度提示和状态更新
- 错误处理和回退机制

## 技术特点

### 1. 专业性
- 基于有限元分析理论
- 符合工程力学原理
- 提供专业的分析结果

### 2. 实用性
- 支持多种材料类型
- 提供多种载荷和约束
- 生成详细的分析报告

### 3. 可视化
- 直观的应力云图显示
- 清晰的颜色映射
- 实时的结果更新

### 4. 扩展性
- 模块化设计
- 易于添加新材料
- 支持自定义算法

## 应用场景

### 1. 结构设计
- 验证结构强度
- 优化结构设计
- 安全系数评估

### 2. 模具分析
- 模具受力分析
- 应力集中识别
- 疲劳寿命预测

### 3. 机械零件
- 零件强度校核
- 应力分布分析
- 设计优化建议

### 4. 教学演示
- 力学原理演示
- 应力分析教学
- 工程应用展示

## 注意事项

### 1. 模型要求
- 模型应为封闭体
- 网格质量影响计算精度
- 复杂模型可能需要较长计算时间

### 2. 参数设置
- 材料属性应准确设置
- 载荷大小应合理
- 约束条件应符合实际情况

### 3. 结果解释
- 应力单位为Pa
- 位移单位为m
- 安全系数为无量纲

### 4. 局限性
- 使用简化的有限元算法
- 适用于线性弹性分析
- 不包含非线性效应

## 未来扩展

### 1. 功能增强
- 添加非线性分析
- 支持动态分析
- 增加热应力分析

### 2. 算法改进
- 更精确的有限元算法
- 自适应网格划分
- 并行计算支持

### 3. 材料库扩展
- 更多材料类型
- 温度相关材料属性
- 用户自定义材料库

### 4. 结果分析
- 应力路径分析
- 疲劳分析
- 优化算法集成

## 总结

受力分析功能为路径切片与仿真系统提供了专业的结构分析能力，通过直观的颜色显示和详细的分析报告，帮助用户快速了解模型的受力情况和安全状态。该功能不仅适用于工程设计和分析，也为教学和演示提供了强大的工具。

通过合理的参数设置和结果解释，用户可以有效地进行结构强度校核、设计优化和安全评估，为工程应用提供可靠的技术支持。 